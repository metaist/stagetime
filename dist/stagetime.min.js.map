{"version":3,"file":"stagetime.min.js","sources":["../src/dom.js","../src/time.js","../src/core.js"],"sourcesContent":["/**\n  Return the elements from a string or selection.\n\n  @private\n  @param {Elements[]|Element|string} elements Either one or more Element\n    objects, or a selector string.\n  @param {Document} context The context of the search.\n  @returns {Elements[]} The selected elements.\n*/\nconst getElements = (elements, context = document) => {\n  var els = [];\n  if (elements.tagName) {\n    els = [elements];\n  } else if ('[object String]' === Object.prototype.toString.call(elements)) {\n    els = Array.from(context.querySelectorAll(elements));\n  } else if (elements.length && elements.length > -1) {\n    els = Array.from(elements);\n  } // end if: have an array\n  return els;\n};\n\nexport {getElements}\nexport default {\n  getElements: getElements\n}\n","/**\n  Maximum number of milliseconds allowed for `setTimeout`.\n  @private\n*/\nconst MAX_TIMEOUT = Math.pow(2, 31) - 1;\n\n/**\n  Convert a date string into the number of milliseconds from the epoch.\n\n  @private\n  @param {string|number|Date} [input] The string to parse.\n  @returns {number} The number of milliseconds from midnight on Jan 1, 1970.\n*/\nconst parseTime = (input) => {\n  let result = null;\n  if (!input) { return result; }\n\n  let constructor = null;\n  let parts = [];\n\n  const tag = Object.prototype.toString.call(input);\n  switch (tag) {\n    case '[object Number]':\n      result = input;\n      break;\n    case '[object Date]':\n      result = input.getTime();\n      break;\n    case '[object String]':\n      constructor = input.endsWith('Z') ?\n        (...args) => Date.UTC(...args) :\n        (...args) => new Date(...args).getTime();\n\n      parts = input.split(/[-.:\\sTZ+]/);\n      result = constructor(\n        parts[0], parts[1] - 1, parts[2], // date\n        parts[3] || 0, parts[4] || 0, parts[5] || 0, parts[6] || 0 // time\n      );\n      break;\n    default:\n      result = null;\n  } // end switch: handle dates and numbers\n\n  return result;\n};\n\n/**\n  @private\n  @typedef {Object} Showtime\n  @property {boolean} is_on Indicates whether the time is within the window.\n  @property {number} show_in Number of milliseconds after which window opens.\n  @property {number} hide_in Number of milliseconds after which window closes.\n*/\n\n/**\n  Return details about whether a time is within a time window.\n\n  @private\n  @param {string} after Start of the time window.\n  @param {string} until End of the time window.\n  @param {string} [now] The current time.\n  @returns {Showtime} Returns details of the time window.\n*/\nconst getShowtimes = (after, until, now = null) => {\n  const t_now = parseTime(now) || new Date().getTime();\n  const t_after = parseTime(after);\n  const t_until = parseTime(until);\n  return {\n    is_on: !(t_after && t_now < t_after) && !(t_until && t_now > t_until),\n    show_in: t_now < t_after ? Math.min(t_after - t_now + 10, MAX_TIMEOUT) : 0,\n    hide_in: t_now < t_until ? Math.min(t_until - t_now + 10, MAX_TIMEOUT) : 0\n  }\n}\n\nexport {parseTime, getShowtimes}\nexport default {\n  parseTime: parseTime,\n  getShowtimes: getShowtimes\n}\n","import {getElements} from './dom';\nimport {getShowtimes} from './time';\n\n\nconst DEFAULTS = {\n  context: document,\n  attr_after: 'data-stagetime-after',\n  attr_until: 'data-stagetime-until',\n  class_on: 'stagetime-on',\n  class_off: 'stagetime-off',\n};\n\n/**\n  Show or hide elements based on data attributes.\n\n  @memberof stagetime\n  @param {Element} [el] Element to initialize. If missing, all elements with\n    either a `data-stagetime-after` or `data-stagetime-until` attributes will be\n    initialized.\n  @param {Object} [settings] Override default settings.\n  @param {Object} [settings.context=document] The context to search for nodes.\n  @param {string} [settings.attr_after] The attribute for time start.\n  @param {string} [settings.attr_until] The attribute for time end.\n  @param {string} [settings.class_on] The class when object should be shown.\n  @param {string} [settings.class_off] The class when object should be hidden.\n  @returns {Element|Element[]} Returns the elements that were initialized.\n  @description\n  * This function inspects the `data-stagetime-after` and `data-stagetime-until`\n  * attributes of the given element and then adds or removes the `stagetime-on`\n  * or `stagetime-off` classes appropriately.\n  *\n  * This function will also schedule future checks in case the `after` or\n  * `until` times are in the future.\n  */\nconst init = (el, settings = {}) => {\n  const opts = Object.assign({}, DEFAULTS, settings);\n\n  if (!el) {\n    const sel = `[${opts.attr_after}],[${opts.attr_until}]`;\n    return getElements(sel, opts.context).map(item => init(item, opts));\n  } // end if: all elements initialized\n\n  const times = getShowtimes(\n    el.getAttribute(opts.attr_after),\n    el.getAttribute(opts.attr_until)\n  );\n\n  el.classList.add(times.is_on ? opts.class_on : opts.class_off);\n  el.classList.remove(times.is_on ? opts.class_off : opts.class_on);\n\n  if (times.show_in) { setTimeout(() => init(el), times.show_in); }\n  if (times.hide_in) { setTimeout(() => init(el), times.hide_in); }\n\n  return el;\n};\n\ninit(); // run automatically\n\nexport {init, DEFAULTS}\nexport default {\n  init: init,\n  DEFAULTS: DEFAULTS\n}\n"],"names":["MAX_TIMEOUT","Math","pow","parseTime","input","result","constructor","parts","Object","prototype","toString","call","getTime","endsWith","args","Date","UTC","split","DEFAULTS","context","document","attr_after","attr_until","class_on","class_off","init","el","settings","opts","assign","elements","els","tagName","Array","from","querySelectorAll","length","getElements","map","item","times","after","until","now","t_now","t_after","t_until","is_on","show_in","min","hide_in","getShowtimes","getAttribute","classList","add","remove","setTimeout"],"mappings":";4LASA,MCLMA,EAAcC,KAAKC,IAAI,EAAG,IAAM,EAShCC,EAAaC,IACjB,IAAIC,EAAS,KACb,IAAKD,EAAS,OAAOC,EAErB,IAAIC,EAAc,KACdC,KAGJ,OADYC,OAAOC,UAAUC,SAASC,KAAKP,IAEzC,IAAK,kBACHC,EAASD,EACT,MACF,IAAK,gBACHC,EAASD,EAAMQ,UACf,MACF,IAAK,kBAMHP,GALAC,EAAcF,EAAMS,SAAS,KAC3B,IAAIC,IAASC,KAAKC,OAAOF,GACzB,IAAIA,IAAS,IAAIC,QAAQD,GAAMF,YAEjCL,EAAQH,EAAMa,MAAM,eAEZ,GAAIV,EAAM,GAAK,EAAGA,EAAM,GAC9BA,EAAM,IAAM,EAAGA,EAAM,IAAM,EAAGA,EAAM,IAAM,EAAGA,EAAM,IAAM,GAE3D,MACF,QACEF,EAAS,KAGb,OAAOA,GCvCHa,GACJC,QAASC,SACTC,WAAY,uBACZC,WAAY,uBACZC,SAAU,eACVC,UAAW,iBAyBPC,EAAO,CAACC,EAAIC,QAChB,MAAMC,EAAOpB,OAAOqB,UAAWX,EAAUS,GAEzC,IAAKD,EAAI,CAEP,MF9BgB,EAACI,EAAUX,EAAUC,YACvC,IAAIW,KAQJ,OAPID,EAASE,QACXD,GAAOD,GACE,oBAAsBtB,OAAOC,UAAUC,SAASC,KAAKmB,GAC9DC,EAAME,MAAMC,KAAKf,EAAQgB,iBAAiBL,IACjCA,EAASM,QAAUN,EAASM,QAAU,IAC/CL,EAAME,MAAMC,KAAKJ,IAEZC,GEqBEM,KADST,EAAKP,gBAAgBO,EAAKN,cAClBM,EAAKT,SAASmB,IAAIC,GAAQd,EAAKc,EAAMX,IAG/D,MAAMY,EDqBa,EAACC,EAAOC,EAAOC,EAAM,QACxC,MAAMC,EAAQzC,EAAUwC,KAAQ,IAAI5B,MAAOH,UACrCiC,EAAU1C,EAAUsC,GACpBK,EAAU3C,EAAUuC,GAC1B,OACEK,QAASF,GAAWD,EAAQC,GAAcC,GAAWF,EAAQE,GAC7DE,QAASJ,EAAQC,EAAU5C,KAAKgD,IAAIJ,EAAUD,EAAQ,GAAI5C,GAAe,EACzEkD,QAASN,EAAQE,EAAU7C,KAAKgD,IAAIH,EAAUF,EAAQ,GAAI5C,GAAe,IC5B7DmD,CACZzB,EAAG0B,aAAaxB,EAAKP,YACrBK,EAAG0B,aAAaxB,EAAKN,aASvB,OANAI,EAAG2B,UAAUC,IAAId,EAAMO,MAAQnB,EAAKL,SAAWK,EAAKJ,WACpDE,EAAG2B,UAAUE,OAAOf,EAAMO,MAAQnB,EAAKJ,UAAYI,EAAKL,UAEpDiB,EAAMQ,SAAWQ,WAAW,IAAM/B,EAAKC,GAAKc,EAAMQ,SAClDR,EAAMU,SAAWM,WAAW,IAAM/B,EAAKC,GAAKc,EAAMU,SAE/CxB,GAGTD"}